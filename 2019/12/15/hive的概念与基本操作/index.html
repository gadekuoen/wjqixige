<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css">

<script class="next-config" data-name="main" type="application/json">{&quot;hostname&quot;:&quot;www.wjqixige.cn&quot;,&quot;root&quot;:&quot;&#x2F;&quot;,&quot;images&quot;:&quot;&#x2F;images&quot;,&quot;scheme&quot;:&quot;Gemini&quot;,&quot;version&quot;:&quot;8.3.0&quot;,&quot;exturl&quot;:false,&quot;sidebar&quot;:{&quot;position&quot;:&quot;left&quot;,&quot;display&quot;:&quot;post&quot;,&quot;padding&quot;:18,&quot;offset&quot;:12},&quot;copycode&quot;:false,&quot;bookmark&quot;:{&quot;enable&quot;:false,&quot;color&quot;:&quot;#222&quot;,&quot;save&quot;:&quot;auto&quot;},&quot;fancybox&quot;:false,&quot;mediumzoom&quot;:false,&quot;lazyload&quot;:false,&quot;pangu&quot;:false,&quot;comments&quot;:{&quot;style&quot;:&quot;tabs&quot;,&quot;active&quot;:null,&quot;storage&quot;:true,&quot;lazyload&quot;:false,&quot;nav&quot;:null},&quot;motion&quot;:{&quot;enable&quot;:false,&quot;async&quot;:false,&quot;transition&quot;:{&quot;post_block&quot;:&quot;fadeIn&quot;,&quot;post_header&quot;:&quot;fadeInDown&quot;,&quot;post_body&quot;:&quot;fadeInDown&quot;,&quot;coll_header&quot;:&quot;fadeInLeft&quot;,&quot;sidebar&quot;:&quot;fadeInUp&quot;}},&quot;prism&quot;:false,&quot;i18n&quot;:{&quot;placeholder&quot;:&quot;搜索...&quot;,&quot;empty&quot;:&quot;没有找到任何搜索结果：${query}&quot;,&quot;hits_time&quot;:&quot;找到 ${hits} 个搜索结果（用时 ${time} 毫秒）&quot;,&quot;hits&quot;:&quot;找到 ${hits} 个搜索结果&quot;}}</script>
<meta name="description" content="Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供类SQL查询功能。其本质是将SQL转换为MapReduce的任务进行运算，底层由HDFS来提供数据的存储，说白了hive可以理解为一个将SQL转换为MapReduce的任务的工具，甚至更进一步可以说hive就是一个MapReduce的客户端 为什么使用Hive  操作接口采用类SQL语法，提供快速开发的能">
<meta property="og:type" content="article">
<meta property="og:title" content="hive的概念与基本操作">
<meta property="og:url" content="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/index.html">
<meta property="og:site_name" content="栖溪阁晓生">
<meta property="og:description" content="Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供类SQL查询功能。其本质是将SQL转换为MapReduce的任务进行运算，底层由HDFS来提供数据的存储，说白了hive可以理解为一个将SQL转换为MapReduce的任务的工具，甚至更进一步可以说hive就是一个MapReduce的客户端 为什么使用Hive  操作接口采用类SQL语法，提供快速开发的能">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006003.png">
<meta property="og:image" content="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006004.png">
<meta property="og:image" content="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006005.png">
<meta property="article:published_time" content="2019-12-15T02:52:26.000Z">
<meta property="article:modified_time" content="2019-12-15T03:13:14.457Z">
<meta property="article:author" content="Mr.wj">
<meta property="article:tag" content="hive">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006003.png">


<link rel="canonical" href="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/">



<script class="next-config" data-name="page" type="application/json">{&quot;sidebar&quot;:&quot;&quot;,&quot;isHome&quot;:false,&quot;isPost&quot;:true,&quot;lang&quot;:&quot;zh-CN&quot;,&quot;comments&quot;:true,&quot;permalink&quot;:&quot;http:&#x2F;&#x2F;www.wjqixige.cn&#x2F;2019&#x2F;12&#x2F;15&#x2F;hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C&#x2F;&quot;,&quot;path&quot;:&quot;2019&#x2F;12&#x2F;15&#x2F;hive的概念与基本操作&#x2F;&quot;,&quot;title&quot;:&quot;hive的概念与基本操作&quot;}</script>

<script class="next-config" data-name="calendar" type="application/json">&quot;&quot;</script>
<title>hive的概念与基本操作 | 栖溪阁晓生</title><script src="/js/config.js"></script>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">栖溪阁晓生</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">个人在线笔记本</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-commonweal"><a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive%E6%9E%B6%E6%9E%84"><span class="nav-text">Hive架构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="nav-text">架构图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="nav-text">基本组成</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive%E4%B8%8EHadoop%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text">Hive与Hadoop的关系</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive%E4%B8%8E%E4%BC%A0%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%B9%E6%AF%94"><span class="nav-text">Hive与传统数据库对比</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive%E7%9A%84%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8"><span class="nav-text">Hive的数据存储</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="nav-text">Hive基本操作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C"><span class="nav-text">数据库操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">创建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B9%B6%E6%8C%87%E5%AE%9Ahdfs%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE"><span class="nav-text">创建数据库并指定hdfs存储位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%AE%E5%80%BC%E5%AF%B9%E4%BF%A1%E6%81%AF"><span class="nav-text">设置数据库键值对信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%AE%E5%80%BC%E5%AF%B9%E4%BF%A1%E6%81%AF"><span class="nav-text">查看数据库键值对信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%AE%E5%80%BC%E5%AF%B9%E4%BF%A1%E6%81%AF"><span class="nav-text">修改数据库键值对信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-text">删除数据库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="nav-text">数据库表操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="nav-text">创建表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E8%A1%A8"><span class="nav-text">内部表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E8%A1%A8"><span class="nav-text">外部表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%8C%BA%E8%A1%A8"><span class="nav-text">分区表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E6%A1%B6%E8%A1%A8"><span class="nav-text">分桶表</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E8%A1%A8"><span class="nav-text">修改表</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hive%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-text">Hive查询语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SELECT"><span class="nav-text">SELECT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-text">查询语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-text">常用函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LIMIT%E8%AF%AD%E5%8F%A5"><span class="nav-text">LIMIT语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WHERE%E8%AF%AD%E5%8F%A5"><span class="nav-text">WHERE语句</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AF%94%E8%BE%83%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%88BETWEEN-IN-IS-NULL%EF%BC%89"><span class="nav-text">比较运算符（BETWEEN&#x2F;IN&#x2F;IS NULL）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LIKE%E5%92%8CRLIKE"><span class="nav-text">LIKE和RLIKE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%88AND-OR-NOT%EF%BC%89"><span class="nav-text">逻辑运算符（AND&#x2F;OR&#x2F;NOT）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E7%BB%84"><span class="nav-text">分组</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JOIN%E8%AF%AD%E5%8F%A5"><span class="nav-text">JOIN语句</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%89%E5%80%BCJOIN"><span class="nav-text">等值JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E8%BF%9E%E6%8E%A5%EF%BC%88INNER-JOIN%EF%BC%89"><span class="nav-text">内连接（INNER JOIN）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A6%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%88LEFT-OUTER-JOIN%EF%BC%89"><span class="nav-text">左外连接（LEFT OUTER JOIN）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%B3%E5%A4%96%E8%BF%9E%E6%8E%A5%EF%BC%88RIGHT-OUTER-JOIN%EF%BC%89"><span class="nav-text">右外连接（RIGHT OUTER JOIN）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E8%A1%A8%E8%BF%9E%E6%8E%A5"><span class="nav-text">多表连接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F"><span class="nav-text">排序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A8%E5%B1%80%E6%8E%92%E5%BA%8F%EF%BC%88ORDER-BY%EF%BC%89"><span class="nav-text">全局排序（ORDER BY）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E7%85%A7%E5%88%AB%E5%90%8D%E6%8E%92%E5%BA%8F"><span class="nav-text">按照别名排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E4%B8%AA%E5%88%97%E6%8E%92%E5%BA%8F"><span class="nav-text">多个列排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AF%8F%E4%B8%AAMR%E5%86%85%E9%83%A8%E6%8E%92%E5%BA%8F%EF%BC%88SORT-BY%EF%BC%89%E5%B1%80%E9%83%A8%E6%8E%92%E5%BA%8F"><span class="nav-text">每个MR内部排序（SORT BY）局部排序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%86%E5%8C%BA%E6%8E%92%E5%BA%8F%EF%BC%88DISTRIBUTE-BY%EF%BC%89"><span class="nav-text">分区排序（DISTRIBUTE BY）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CLUSTER-BY"><span class="nav-text">CLUSTER BY</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0"><span class="nav-text">内置函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="nav-text">Hive自定义函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#UDF%E5%BC%80%E5%8F%91%E5%AE%9E%E4%BE%8B"><span class="nav-text">UDF开发实例</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <a href="/"><img class="site-author-image" itemprop="image" alt="Mr.wj" src="/uploads/logo.jpg"></a>
  <p class="site-author-name" itemprop="name">Mr.wj</p>
  <div class="site-description" itemprop="description">欢迎来到栖息阁晓生博客</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/gadekuoen/wjqixige" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;gadekuoen&#x2F;wjqixige" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/wujiang569@126.com" title="E-Mail → wujiang569@126.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://me.csdn.net/weixin_39455881" title="CSDN → https:&#x2F;&#x2F;me.csdn.net&#x2F;weixin_39455881" rel="noopener" target="_blank"><i class="crosshairs fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/2983932047/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="微博 → https:&#x2F;&#x2F;weibo.com&#x2F;2983932047&#x2F;profile?rightmod&#x3D;1&amp;wvr&#x3D;6&amp;mod&#x3D;personinfo&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>微博</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.wjqixige.cn/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/logo.jpg">
      <meta itemprop="name" content="Mr.wj">
      <meta itemprop="description" content="欢迎来到栖息阁晓生博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="栖溪阁晓生">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          hive的概念与基本操作
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2019-12-15 10:52:26 / 修改时间：11:13:14" itemprop="dateCreated datePublished" datetime="2019-12-15T10:52:26+08:00">2019-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url" rel="index"><span itemprop="name">大数据</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Hive是基于Hadoop的一个数据仓库工具，可以将<strong>结构化的数据</strong>文件映射为一张数据库表，并提供类SQL查询功能。其本质是将SQL转换为MapReduce的任务进行运算，底层由HDFS来提供数据的存储，说白了hive可以理解为一个将SQL转换为MapReduce的任务的工具，甚至更进一步可以说hive就是一个MapReduce的客户端</p>
<p><strong>为什么使用Hive</strong></p>
<ul>
<li>操作接口采用类SQL语法，提供快速开发的能力。 </li>
<li>避免了去写MapReduce，减少开发人员的学习成本。 </li>
<li>功能扩展很方便。</li>
</ul>
<p><strong>Hive的特点</strong></p>
<ul>
<li>可扩展 ：Hive可以自由的扩展集群的规模，一般情况下不需要重启服务。</li>
<li>延展性： Hive支持用户自定义函数，用户可以根据自己的需求来实现自己的函数。 </li>
<li>容错： 良好的容错性，节点出现问题SQL仍可完成执行。</li>
</ul>
<span id="more"></span>

<h1 id="Hive架构"><a href="#Hive架构" class="headerlink" title="Hive架构"></a>Hive架构</h1><h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><img src="/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006003.png" class="">

<h2 id="基本组成"><a href="#基本组成" class="headerlink" title="基本组成"></a>基本组成</h2><p><strong>用户接口</strong>：包括CLI、JDBC/ODBC、WebGUI。其中，CLI(command line interface)为shell命令行；JDBC/ODBC是Hive的java实现，与传统数据库JDBC类似；WebGUI是通过浏览器访问Hive。</p>
<p><strong>元数据存储</strong>：通常是存储在关系数据库如mysql/derby中。Hive 将元数据存储在数据库中。Hive 中的元数据包括表的名字，表的列和分区及其属性，表的属性（是否为外部表等），表的数据所在目录等。</p>
<p><strong>解释器、编译器、优化器、执行器</strong>：完成HQL 查询语句从词法分析、语法分析、编译、优化以及查询计划的生成。生成的查询计划存储在HDFS 中，并在随后有MapReduce 调用执行。</p>
<h1 id="Hive与Hadoop的关系"><a href="#Hive与Hadoop的关系" class="headerlink" title="Hive与Hadoop的关系"></a>Hive与Hadoop的关系</h1><p>Hive利用HDFS存储数据，利用MapReduce查询分析数据。</p>
<img src="/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006004.png" class="">

<h1 id="Hive与传统数据库对比"><a href="#Hive与传统数据库对比" class="headerlink" title="Hive与传统数据库对比"></a>Hive与传统数据库对比</h1><p>hive用于海量数据的离线数据分析</p>
<img src="/2019/12/15/hive%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/wj-hive-20191006005.png" class="">

<p><em><strong>总结：hive具有sql数据库的外表，但引用场景完全不同，hive只适合用来做批量数据统计分析。</strong></em></p>
<h1 id="Hive的数据存储"><a href="#Hive的数据存储" class="headerlink" title="Hive的数据存储"></a>Hive的数据存储</h1><ol>
<li><p>Hive中所有的数据都存储在 HDFS 中，没有专门的数据存储格式（可支持Text，SequenceFile，ParquetFile，ORC格式RCFILE等）</p>
<p>SequenceFile是hadoop中的一种文件格式：文件内容是以序列化的kv对象来组织的。</p>
</li>
<li><p>只需要在创建表的时候告诉 Hive 数据中的列分隔符和行分隔符，Hive 就可以解析数据。</p>
</li>
<li><p>Hive 中包含以下数据模型：DB、Table，External Table，Partition，Bucket。</p>
<ul>
<li><strong>db</strong>：在hdfs中表现为${hive.metastore.warehouse.dir}目录下一个文件夹</li>
<li><strong>table</strong>：在hdfs中表现所属db目录下一个文件夹</li>
<li><strong>external table</strong>：与table类似，不过其数据存放位置可以在任意指定路径</li>
<li><strong>partition</strong>：在hdfs中表现为table目录下的子目录</li>
<li><strong>bucket</strong>：在hdfs中表现为同一个表目录下根据散列之后的多个文件</li>
</ul>
</li>
</ol>
<h1 id="Hive基本操作"><a href="#Hive基本操作" class="headerlink" title="Hive基本操作"></a>Hive基本操作</h1><h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> myhive;</span><br><span class="line">use myhive;</span><br></pre></td></tr></table></figure>

<p>说明：hive的表存放位置模式是由hive-site.xml当中的一个属性指定的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>hive.metastore.warehouse.dir<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">value</span>&gt;</span>/user/hive/warehouse<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="创建数据库并指定hdfs存储位置"><a href="#创建数据库并指定hdfs存储位置" class="headerlink" title="创建数据库并指定hdfs存储位置"></a>创建数据库并指定hdfs存储位置</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database myhive2 location <span class="string">&#x27;/myhive2&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h3 id="设置数据库键值对信息"><a href="#设置数据库键值对信息" class="headerlink" title="设置数据库键值对信息"></a>设置数据库键值对信息</h3><p>数据库可以有一些描述性的键值对信息，在创建时添加：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database foo <span class="keyword">with</span> dbproperties(<span class="string">&#x27;owner&#x27;</span><span class="operator">=</span><span class="string">&#x27;wjqixige&#x27;</span>,<span class="string">&#x27;date&#x27;</span><span class="operator">=</span><span class="string">&#x27;20190120&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="查看数据库键值对信息"><a href="#查看数据库键值对信息" class="headerlink" title="查看数据库键值对信息"></a>查看数据库键值对信息</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> database extended myhive2;</span><br></pre></td></tr></table></figure>

<h3 id="修改数据库键值对信息"><a href="#修改数据库键值对信息" class="headerlink" title="修改数据库键值对信息"></a>修改数据库键值对信息</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> database foo <span class="keyword">set</span> dbproperties(<span class="string">&#x27;owner&#x27;</span><span class="operator">=</span><span class="string">&#x27;wjqixige&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>删除一个空数据库，如果数据库下面有数据表，那么就会报错</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> database myhive2;</span><br></pre></td></tr></table></figure>

<p>强制删除数据库，包含数据库下面的表一起删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database myhive2 cascade;</span><br></pre></td></tr></table></figure>

<h2 id="数据库表操作"><a href="#数据库表操作" class="headerlink" title="数据库表操作"></a>数据库表操作</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> [<span class="keyword">external</span>] <span class="keyword">table</span> [if <span class="keyword">not</span> <span class="keyword">exists</span>] table_name(</span><br><span class="line">	col_name data_type [comment <span class="string">&#x27;字段描述信息&#x27;</span>]，</span><br><span class="line">    col_name data_type [comment <span class="string">&#x27;字段描述信息&#x27;</span>]) </span><br><span class="line">   [comment <span class="string">&#x27;表描述信息&#x27;</span>] </span><br><span class="line">   [partitioned <span class="keyword">by</span> (col_name data_type [comment <span class="string">&#x27;字段描述信息&#x27;</span>], ...)] </span><br><span class="line">   [clustered <span class="keyword">by</span> (col_name, col_name, ...) </span><br><span class="line">   [sorted <span class="keyword">by</span> (col_name [<span class="keyword">ASC</span><span class="operator">|</span><span class="keyword">DESC</span>], ...)] <span class="keyword">into</span> num_buckets buckets] </span><br><span class="line">   [<span class="type">row</span> format row_format] </span><br><span class="line">   [stored <span class="keyword">as</span> file_format] </span><br><span class="line">   [location <span class="string">&#x27;指定表的路径&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p><strong>说明：</strong></p>
<ol>
<li><strong>create table</strong> ：创建一个指定名字的表。如果相同名字的表已经存在，则抛出异常；用户可以用 IF NOT EXISTS 选项来忽略这个异常。</li>
<li><strong>external</strong>：关键字可以让用户创建一个外部表，在建表的同时指定一个指向实际数据的路径（LOCATION），Hive 创建内部表时，会将数据移动到数据仓库指向的路径；若创建外部表，仅记录数据所在的路径，不对数据的位置做任何改变。在删除表的时候，内部表的元数据和数据会被一起删除，而外部表只删除元数据，不删除数据。</li>
<li><strong>comment</strong>：表示注释，默认不能使用中文</li>
<li><strong>partitioned by</strong>：表示使用表分区，一个表可以拥有一个或者多个分区，每一个分区单独存在一个目录下</li>
<li><strong>clustered by</strong>：对于每一个表分文件，Hive可以进一步组指成桶，也就是说桶是更为细粒度的数据范围划分。Hive也是针对某一列进行桶的组织。</li>
<li><strong>sorted by</strong>：指定排序字段和排序规则</li>
<li><strong>row format</strong>：指定表文件字段分隔符</li>
<li>**sorted as **:指定表文案及你的存储格式。常用格式：SEQUENCEFILE, TEXTFILE,RCFILE,如果文件数据是纯文本，可以使用SRORED AS TEXTFILE。如果数据需要压缩，使用storted as SEQUENCEFILE。</li>
<li><strong>location</strong>：指定表文件的存储路径</li>
</ol>
<h3 id="内部表"><a href="#内部表" class="headerlink" title="内部表"></a>内部表</h3><p>创建表时，如果没有使用external关键字，则该表是内部表（managed table）</p>
<p><strong>Hive建表字段类型</strong></p>
<table>
<thead>
<tr>
<th>分类</th>
<th>类型</th>
<th>描述</th>
<th>字面量示例</th>
</tr>
</thead>
<tbody><tr>
<td>原始类型</td>
<td>BOOLEAN</td>
<td>true/false</td>
<td>TRUE</td>
</tr>
<tr>
<td></td>
<td>TINYINT</td>
<td>1字节的有符号整数 -128~127</td>
<td>1Y</td>
</tr>
<tr>
<td></td>
<td>SMALLINT</td>
<td>2字节的有符号整数，112768~12767</td>
<td>1S</td>
</tr>
<tr>
<td></td>
<td>INT</td>
<td>4个字节的带符号整数</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>BIGINT</td>
<td>8字节带符号整数</td>
<td>1L</td>
</tr>
<tr>
<td></td>
<td>FLOAT</td>
<td>4字节单精度浮点数</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>DOUBLE</td>
<td>8字节双精度浮点数</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>DEICIMAL</td>
<td>任意精度的带符号小数</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>STRING</td>
<td>字符串，变长</td>
<td>“a”,’b’</td>
</tr>
<tr>
<td></td>
<td>VARCHAR</td>
<td>变长字符串</td>
<td>“a”,’b’</td>
</tr>
<tr>
<td></td>
<td>CHAR</td>
<td>固定长度字符串</td>
<td>“a”,’b’</td>
</tr>
<tr>
<td></td>
<td>BINARY</td>
<td>字节数组</td>
<td>无法表示</td>
</tr>
<tr>
<td></td>
<td>TIMESTAMP</td>
<td>时间戳，毫秒值精度</td>
<td>122127491795</td>
</tr>
<tr>
<td></td>
<td>DATE</td>
<td>日期</td>
<td>‘2019-10-06’</td>
</tr>
<tr>
<td></td>
<td>INTERVAL</td>
<td>时间频率间隔</td>
<td></td>
</tr>
<tr>
<td>复杂类型</td>
<td>ARRAY</td>
<td>有序的同类型的集合</td>
<td>array(1,2)</td>
</tr>
<tr>
<td></td>
<td>MAP</td>
<td>key-value，key必须为原始类型，<br />value任意类型</td>
<td>map(‘a’,1,’b’,2)</td>
</tr>
<tr>
<td></td>
<td>STRUCT</td>
<td>字段集合，类型可以不同</td>
<td>struct(‘1’,1,1.0),<br />named_stract<br />(‘col1’,’1’,’col2’,1,’col1’,1.0)</td>
</tr>
<tr>
<td></td>
<td>UNION</td>
<td>在有限取值范围内的一个值</td>
<td>create_union(1,’a’,61)</td>
</tr>
</tbody></table>
<p><strong>建表入门</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use myhive;</span><br><span class="line">create table stu(id int,name string);</span><br><span class="line">insert into stu values(1,&quot;zhangsan&quot;);</span><br><span class="line">select * fomr stu;</span><br></pre></td></tr></table></figure>

<p><strong>创建表并指定字段之间的分隔符</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists stu2(id int,name string) row format delimited fields terminated by &#39;\t&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>创建表并指定表文件的存放路径</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table if not exists stu2(id int,name string) row format delimited fields terminated by &#39;\t&#39; location &#39;&#x2F;user&#x2F;stu2&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>根据查询结果创建表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table stu1 as select * from stu2; ##通过复制表结构和表内容创建新表</span><br></pre></td></tr></table></figure>

<p><strong>根据已经存在的表结构创建表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table stu4 like stu;</span><br></pre></td></tr></table></figure>

<p><strong>查询表的详细信息</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc formatted stu2;</span><br></pre></td></tr></table></figure>

<p><strong>删除表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table stu;</span><br></pre></td></tr></table></figure>

<h3 id="外部表"><a href="#外部表" class="headerlink" title="外部表"></a>外部表</h3><p><strong>外部表说明</strong></p>
<p>外部表因为是指定其他的hdfs路径的数据加载到表当中来，所以hive表会认为自己不完全独占这份数据，所以删除hive表的时候，数据仍然存放在hdfs当中，不会删掉。</p>
<p><strong>内部表和外部表的使用场景</strong></p>
<p>每天将收集到的网站日志定期流入HDFS文本文件。在外部表（原始日志表）的基础上做大量的统计分析，用到的中间表、结果表使用内部表存储，数据通过SELECT+INSERT进入内部表。</p>
<p><strong>操作案例</strong></p>
<p>分别创建老师与学生外部表，并向表中加载数据</p>
<ol>
<li><p>创建老师表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create external table teacher(t_id string,t_name string) row format delimited fields terminated by &#39;\t&#39;;</span><br></pre></td></tr></table></figure></li>
<li><p>创建学生表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create external table student(s_id string,s_name string,s_birth string,s_sex string) row format delimited fields fields terminated by &#39;\t&#39;;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>从本地文件系统向表中加载数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#39;&#x2F;export&#x2F;servers&#x2F;hivedatas&#x2F;student.csv&#39; into table student;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>加载数据并覆盖已有数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#39;&#x2F;export&#x2F;servers&#x2F;hivedatas&#x2F;student.csv&#39; overwrite into table student;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>从hdfs文件系统向表加载数据（需要提前将数据上传到hdfs文件系统）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /root/hivedatas</span><br><span class="line">$ hdfs dfs -mkdir -p /hivedatas</span><br><span class="line">$ hdfs dfs -put teacher.csv /hivedatas/</span><br><span class="line">$ <span class="built_in">local</span> data input <span class="string">&#x27;hivedatas/teacher.csv&#x27;</span> into table teacher;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>如果删掉student表，hdfs的数据仍然存在，并且重新创建表之后，表中就直接存在数据了，因为我们的student表使用的是外部表，drop table之后，表当中的数据依然保留在hdfs上面。</p>
<h3 id="分区表"><a href="#分区表" class="headerlink" title="分区表"></a>分区表</h3><p>在大数据中，最常用的一种思想就是分治，我们可以把大的文件切割划分成一个个的小文件，这样每次操作一个小的文件就很容易了，同样的道理，在hive中也是支持这种思想的，就是我么你可以把大的数据，按照每月，或者天进行切分成一个个的小的文件，这样去操作小的文件就很容易了。</p>
<p><strong>创建分区表语法</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table score(s_id string,c_id string,s_score int) partitioned by (month string) row format delimited fields terminated by &#39;\t&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>创建一个表带多个分区</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table score2(s_id string,c_id string,s_score int) partitioned by(year string,month string,day string) row format delimited fields terminated by &#39;\t&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>加载数据到分区表中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#39;&#x2F;export&#x2F;servers&#x2F;hivedatas&#x2F;score.csv&#39; into table score partition(month&#x3D;&#39;201910&#39;);</span><br></pre></td></tr></table></figure>

<p><strong>加载数据到一个多分区的表中</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#39;&#x2F;export&#x2F;servers&#x2F;hivedatas&#x2F;score.csv&#39; into table score2 partition(year&#x3D;&#39;2019&#39;,month&#x3D;&#39;10&#39;,day&#x3D;&#39;07&#39;);</span><br></pre></td></tr></table></figure>

<p><strong>多分区联合查询(使用union all)</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * form score where month&#x3D;&#39;201910&#39; union all select * from score where month&#x3D;&#39;201909&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>查看分区</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show partitions score;</span><br></pre></td></tr></table></figure>

<p><strong>添加一个分区</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table score add partition(month&#x3D;&#39;201910&#39;);</span><br></pre></td></tr></table></figure>

<p><strong>同时添加多个分区</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table score add partition(month&#x3D;&#39;201010&#39;) partition(month&#x3D;&#39;201011&#39;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>删除分区</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table score drop partition(month&#x3D;&#39;201010&#39;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="分桶表"><a href="#分桶表" class="headerlink" title="分桶表"></a>分桶表</h3><p>分桶，就是将数据按照指定的字段进行划分到多个文件当中去，分桶就是MapReduce中的分区。</p>
<p><strong>开启hive的分桶功能</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set hive.enforce.bucketing&#x3D;true;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>设置reduce的个数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set mapreduce.job.reduces&#x3D;1;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>创建分桶表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table course(c_id string,c_name string,t_id string) clustered by(c_id) into 1 buckets row format delimited fields terminated by &#39;\t&#39;;</span><br></pre></td></tr></table></figure>

<p>桶表的数据加载，由于桶表的数据加载通过hdfs dfs -put文件或通过load data均不好使，只能通过<code>insert overwrite</code>的方式将普通表的数据通过查询的方式加载到桶表当中去。</p>
<p><strong>创建普通表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create table course_common(c_id string,c_name string,t_id string) row format delimited fields terminated by &#39;\t&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>普通表中加载数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data local inpath &#39;&#x2F;hivedatas&#x2F;course.csv&#39; into table course_common;</span><br></pre></td></tr></table></figure>

<p><strong>通过insert overwrite给桶表中加载数据</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite table course select * from course_common cluster by(c_id);</span><br></pre></td></tr></table></figure>

<h3 id="修改表"><a href="#修改表" class="headerlink" title="修改表"></a>修改表</h3><p><strong>重命名</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table old_table_name rename to new_table_name;</span><br></pre></td></tr></table></figure>

<p><strong>增加/修改列信息</strong></p>
<ul>
<li><p>查询表结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc table_name;</span><br></pre></td></tr></table></figure></li>
<li><p>添加列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name add columns(col_name data_type,...);</span><br></pre></td></tr></table></figure></li>
<li><p>更新列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table table_name change clomns col_name new_col_name new_data_type;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>删除表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop table tableName;</span><br></pre></td></tr></table></figure>

<h2 id="Hive查询语法"><a href="#Hive查询语法" class="headerlink" title="Hive查询语法"></a>Hive查询语法</h2><h3 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SELECT [ALL | DISTINCT] select_expr,select_expr,...</span><br><span class="line">FORM table_reference</span><br><span class="line">[WHERE where_condition]</span><br><span class="line">[GROUP BY col_list [HVAING condition]]</span><br><span class="line">[ClUSTER BY col_list </span><br><span class="line"> | [DISTRIBUTE BY col_list] [SORT BY | ORDER BY col_list]</span><br><span class="line">]</span><br><span class="line">[LIMIT number]</span><br></pre></td></tr></table></figure>

<ol>
<li><strong>order by</strong>会对输入的全局排序，因此只有一个reducer,会导致当输入规模较大时，需要较长的计算时间。</li>
<li><strong>sort by</strong>不是全局排序，其在数据进入reducer前reducer前完成排序，因此，如果用sort by进行排序，并且设置mapred.reduce.task&gt;1, 则sort by只保证每个reducer的输出有序，不保证全局有序。</li>
<li>**distribute by(字段)**根据指定的字段数据分到不同reducer,且分发算法是hash散列。</li>
<li>**cluster by(字段)**除了具有distribute by的功能外，还会对该字段进行排序。</li>
</ol>
<p>因此，如果distribute和sort字段是同一个时，此时，<code>cluster by=distribute by + sort by</code></p>
<h3 id="查询语法"><a href="#查询语法" class="headerlink" title="查询语法"></a>查询语法</h3><p><strong>全表查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from table_name;</span><br></pre></td></tr></table></figure>

<p><strong>选择特定列查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select col_name1,col_name2,... from table_name;</span><br></pre></td></tr></table></figure>

<p><strong>列别名</strong></p>
<ol>
<li>重命名一个列</li>
<li>便于计算</li>
<li>紧跟列明，也可以在列明和别名之间加入关键字<code>as</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select col_name1 as name1, col_name2 from table_name</span><br></pre></td></tr></table></figure>

<h2 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h2><ul>
<li><p>求总行数（count）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">## count(1) 等价于 count(*)</span><br><span class="line">select count(1) form table_name;</span><br></pre></td></tr></table></figure></li>
<li><p>求分数的最大值（max）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select max(s_score) from score;</span><br></pre></td></tr></table></figure></li>
<li><p>求分数的最小值（min）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select min(s_score) from score;</span><br></pre></td></tr></table></figure></li>
<li><p>求分数的总和（sum）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select sum(s_score) from score;</span><br></pre></td></tr></table></figure></li>
<li><p>求分数的平均值（avg）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select avg(s_score) from score;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="LIMIT语句"><a href="#LIMIT语句" class="headerlink" title="LIMIT语句"></a>LIMIT语句</h2><p>用于限制返回的行数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from score limit 1;</span><br></pre></td></tr></table></figure>

<h2 id="WHERE语句"><a href="#WHERE语句" class="headerlink" title="WHERE语句"></a>WHERE语句</h2><ol>
<li>使用where子句，将不满足条件的行过滤掉</li>
<li>where子句紧随from子句</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from score where s_score &gt; 60;</span><br></pre></td></tr></table></figure>

<h2 id="比较运算符（BETWEEN-IN-IS-NULL）"><a href="#比较运算符（BETWEEN-IN-IS-NULL）" class="headerlink" title="比较运算符（BETWEEN/IN/IS NULL）"></a>比较运算符（BETWEEN/IN/IS NULL）</h2><table>
<thead>
<tr>
<th>操作符</th>
<th>支持的数据类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>A=B</td>
<td>基本数据类型</td>
<td>如果A等于B则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A&lt;=&gt;B</td>
<td>基本数据类型</td>
<td>如果A和B都为NULL，则返回TRUE，其他的和等号（=）操作符的结果一致，如果任一为NULL则结果为NULL</td>
</tr>
<tr>
<td>A&lt;&gt;B, A!=B</td>
<td>基本数据类型</td>
<td>A或者B为NULL则返回NULL；如果A不等于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A&lt;B</td>
<td>基本数据类型</td>
<td>A或者B为NULL，则返回NULL；如果A小于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A&lt;=B</td>
<td>基本数据类型</td>
<td>A或者B为NULL，则返回NULL；如果A小于等于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A&gt;B</td>
<td>基本数据类型</td>
<td>A或者B为NULL，则返回NULL；如果A大于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A&gt;=B</td>
<td>基本数据类型</td>
<td>A或者B为NULL，则返回NULL；如果A大于等于B，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A [NOT] BETWEEN B AND C</td>
<td>基本数据类型</td>
<td>如果A，B或者C任一为NULL，则结果为NULL。如果A的值大于等于B而且小于或等于C，则结果为TRUE，反之为FALSE。如果使用NOT关键字则可达到相反的效果。</td>
</tr>
<tr>
<td>A IS NULL</td>
<td>所有数据类型</td>
<td>如果A等于NULL，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>A IS NOT NULL</td>
<td>所有数据类型</td>
<td>如果A不等于NULL，则返回TRUE，反之返回FALSE</td>
</tr>
<tr>
<td>IN(数值1, 数值2)</td>
<td>所有数据类型</td>
<td>使用 IN运算显示列表中的值</td>
</tr>
<tr>
<td>A [NOT] LIKE B</td>
<td>STRING 类型</td>
<td>B是一个SQL下的简单正则表达式，如果A与其匹配的话，则返回TRUE；反之返回FALSE。B的表达式说明如下：‘x%’表示A必须以字母‘x’开头，‘%x’表示A必须以字母’x’结尾，而‘%x%’表示A包含有字母’x’,可以位于开头，结尾或者字符串中间。如果使用NOT关键字则可达到相反的效果。</td>
</tr>
<tr>
<td>A RLIKE B, A REGEXP B</td>
<td>STRING 类型</td>
<td>B是一个正则表达式，如果A与其匹配，则返回TRUE；反之返回FALSE。匹配使用的是JDK中的正则表达式接口实现的，因为正则也依据其中的规则。例如，正则表达式必须和整个字符串A相匹配，而不是只需与其字符串匹配。</td>
</tr>
</tbody></table>
<h2 id="LIKE和RLIKE"><a href="#LIKE和RLIKE" class="headerlink" title="LIKE和RLIKE"></a>LIKE和RLIKE</h2><ol>
<li>使用LIKE运算选择类似的值</li>
<li>选择条件可以包含字符或数字<ul>
<li>**%**：代表零个或多个字符（任意个字符） </li>
<li>**_**：代表一个字符</li>
</ul>
</li>
<li>RLIKE子句是Hive中这个功能的一个扩展，其可以通过<strong>Java的正则表达式</strong>这个更强大的语言来指定匹配条件</li>
</ol>
<h2 id="逻辑运算符（AND-OR-NOT）"><a href="#逻辑运算符（AND-OR-NOT）" class="headerlink" title="逻辑运算符（AND/OR/NOT）"></a>逻辑运算符（AND/OR/NOT）</h2><table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>AND</td>
<td>逻辑并</td>
</tr>
<tr>
<td>OR</td>
<td>逻辑或</td>
</tr>
<tr>
<td>NOT</td>
<td>逻辑否</td>
</tr>
</tbody></table>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p><strong>GROUP BY语句</strong></p>
<p>GROUP BY语句通常会和聚合函数一起使用，按照一个或者多个队列结果进行分组，然后对每个组执行聚合操作。 </p>
<p><strong>HAVING语句</strong></p>
<ol>
<li>having与where不同点<ol>
<li>where针对<strong>表中的列</strong>发挥作用，查询数据；having针对<strong>查询结果中的列</strong>发挥作用，筛选数据</li>
<li>where后面不能写分组函数，而having后面可以使用分组函数</li>
<li>having只用于group by分组统计语句</li>
</ol>
</li>
</ol>
<h2 id="JOIN语句"><a href="#JOIN语句" class="headerlink" title="JOIN语句"></a>JOIN语句</h2><h3 id="等值JOIN"><a href="#等值JOIN" class="headerlink" title="等值JOIN"></a>等值JOIN</h3><p>Hive支持通常的SQL JOIN语句，但是<strong>只支持等值连接，不支持非等值连接</strong>。举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s.s_id,s.s_score,stu.s_name,stu.s_birth from score s left join student stu on s.s_id&#x3D;stu.s_id;</span><br></pre></td></tr></table></figure>

<h3 id="内连接（INNER-JOIN）"><a href="#内连接（INNER-JOIN）" class="headerlink" title="内连接（INNER JOIN）"></a>内连接（INNER JOIN）</h3><p>只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来。举例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from teacher t inner join course c on t.t_id&#x3D;c.t_id;</span><br></pre></td></tr></table></figure>

<h3 id="左外连接（LEFT-OUTER-JOIN）"><a href="#左外连接（LEFT-OUTER-JOIN）" class="headerlink" title="左外连接（LEFT OUTER JOIN）"></a>左外连接（LEFT OUTER JOIN）</h3><p>JOIN操作符左边表中复合WHERE子句的所有记录将会被返回。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher t <span class="keyword">left</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id <span class="operator">=</span> c.t_id;</span><br></pre></td></tr></table></figure>

<h3 id="右外连接（RIGHT-OUTER-JOIN）"><a href="#右外连接（RIGHT-OUTER-JOIN）" class="headerlink" title="右外连接（RIGHT OUTER JOIN）"></a>右外连接（RIGHT OUTER JOIN）</h3><p>JOIN操作符右边表中复合WHERE子句的所有记录将会被返回。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher t <span class="keyword">right</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id <span class="operator">=</span> c.t_id;</span><br></pre></td></tr></table></figure>

<h3 id="多表连接"><a href="#多表连接" class="headerlink" title="多表连接"></a>多表连接</h3><p><em><strong>注意：连接n个表，至少需要n-1个连接条件</strong></em>。例如：连接三个表 ，至少需要两个连接条件。</p>
<p>多表连接查询，查询老师对应的课程，以及对应的分数，对应的学生</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> teacher t <span class="keyword">left</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id <span class="operator">=</span> c.t_id <span class="keyword">left</span> <span class="keyword">join</span> score s <span class="keyword">on</span> s.c_id<span class="operator">=</span>c.c_id <span class="keyword">left</span> <span class="keyword">join</span> student stu <span class="keyword">on</span> s.s_id <span class="operator">=</span> stu.s_id;</span><br></pre></td></tr></table></figure>

<h2 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h2><h3 id="全局排序（ORDER-BY）"><a href="#全局排序（ORDER-BY）" class="headerlink" title="全局排序（ORDER BY）"></a>全局排序（ORDER BY）</h3><p><strong>ORDER BY</strong>：全局排序，一个reduce</p>
<ol>
<li><p>使用ORDER BY子句排序<code>ASC</code>(升序，默认)，<code>DESC</code>(降序)</p>
</li>
<li><p>ORDER BY子句在SELECT语句的结尾</p>
</li>
<li><p>举例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from student s left join score sco on s.s_id&#x3D;sco.s_id order by sco.s_score DESC;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="按照别名排序"><a href="#按照别名排序" class="headerlink" title="按照别名排序"></a>按照别名排序</h3><p>按照分数的平均值排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s_id,avg(s_score) avg from score group by s_id order by avg;</span><br></pre></td></tr></table></figure>

<h3 id="多个列排序"><a href="#多个列排序" class="headerlink" title="多个列排序"></a>多个列排序</h3><p>按照学生id和平均成绩进行排序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select s_id ,avg(s_score) avg from score group by s_id order by s_id,avg;</span><br></pre></td></tr></table></figure>

<h3 id="每个MR内部排序（SORT-BY）局部排序"><a href="#每个MR内部排序（SORT-BY）局部排序" class="headerlink" title="每个MR内部排序（SORT BY）局部排序"></a>每个MR内部排序（SORT BY）局部排序</h3><p>Sort By：每个MapReduce内部进行排序，对全局结果集来说不是排序。</p>
<ol>
<li><p>设置reduce个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set mapreduce.job.reduces&#x3D;1;</span><br></pre></td></tr></table></figure></li>
<li><p>查看设置reduce个数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set mapreduce.job.reduces;</span><br></pre></td></tr></table></figure></li>
<li><p>查询成绩按照成绩降序排列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from score sort by s_score;</span><br></pre></td></tr></table></figure></li>
<li><p>将查询结果导入到文件中（按照成绩降序排列）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert overwrite local directory &#39;&#x2F;hivedatas&#x2F;sort&#39; select * from score sort by s_socre;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="分区排序（DISTRIBUTE-BY）"><a href="#分区排序（DISTRIBUTE-BY）" class="headerlink" title="分区排序（DISTRIBUTE BY）"></a>分区排序（DISTRIBUTE BY）</h3><p><strong>Distribute By</strong>：类似MR中partition，进行分区，结合sort by使用。</p>
<p><em><strong>注意，Hive要求DISTRIBUTE BY语句要写在SORT BY语句之前</strong></em>。</p>
<p>对于distribute by进行测试，一定要分配多reduce进行处理，否则无法看到distribute by的效果。</p>
<h3 id="CLUSTER-BY"><a href="#CLUSTER-BY" class="headerlink" title="CLUSTER BY"></a>CLUSTER BY</h3><p>当distribute by和sort by字段相同时，可以使用cluster by方式。</p>
<p>cluster by除了具有distribute by的功能外还兼具sort by的功能。<strong>但是排序只能是倒序排序，不能指定排序规则为ASC或者DESC</strong>。</p>
<p>以下两种写法等价</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from score cluster by s_id;</span><br><span class="line">select * from score distribute by s_id sort by s_id;</span><br></pre></td></tr></table></figure>

<h1 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h1><p>内容较多，见《Hive官方文档》：<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF">https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF</a></p>
<ol>
<li><p>查看系统自带的函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; show functions;</span><br></pre></td></tr></table></figure></li>
<li><p>显示自带的函数的用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc function upper;</span><br></pre></td></tr></table></figure></li>
<li><p>详细显示自带的函数的用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive&gt; desc function extended upper;</span><br></pre></td></tr></table></figure></li>
</ol>
<h1 id="Hive自定义函数"><a href="#Hive自定义函数" class="headerlink" title="Hive自定义函数"></a>Hive自定义函数</h1><ol>
<li><p>Hive 自带了一些函数，比如：max/min等，但是数量有限，自己可以通过自定义UDF来方便的扩展。</p>
</li>
<li><p>当Hive提供的内置函数无法满足你的业务处理需要时，此时就可以考虑使用用户自定义函数（UDF：user-defined function）。</p>
</li>
<li><p>根据用户自定义函数类别分为以下三种：</p>
<ol>
<li><strong>UDF（User-Defined-Function）</strong>：一进一出</li>
<li><strong>UDAF（User-Defined Aggregation Function）</strong>：聚集函数，多进一出，类似于：count/max/min</li>
<li><strong>UDTF（User-Defined Table-Generating Functions）</strong>：一进多出，如lateral view explore()</li>
</ol>
</li>
<li><p>官方文档地址：<a target="_blank" rel="noopener" href="https://cwiki.apache.org/confluence/display/Hive/HivePlugins">https://cwiki.apache.org/confluence/display/Hive/HivePlugins</a></p>
</li>
<li><p><strong>编程步骤：</strong></p>
<ol>
<li>继承org.apache.hadoop.hive.ql.UDF</li>
<li>需要实现evaluate函数；evaluate函数支持重载；</li>
</ol>
</li>
<li><p>注意事项</p>
<ol>
<li>UDF必须要有返回类型，可以返回null，但是返回类型不能为void；</li>
<li><strong>UDF中常用Text/LongWritable等类型，不推荐使用java类型；</strong></li>
</ol>
</li>
</ol>
<h1 id="UDF开发实例"><a href="#UDF开发实例" class="headerlink" title="UDF开发实例"></a>UDF开发实例</h1><p><strong>简单UDF示例</strong></p>
<ol>
<li><p>创建maven  java 工程，导入jar包;</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>cloudera<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hadoop<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hadoop-common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.0-cdh5.14.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hive<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hive-exec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0-cdh5.14.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;<span class="name">filters</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">artifact</span>&gt;</span>*:*<span class="tag">&lt;/<span class="name">artifact</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                                 <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.SF<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                                 <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*.DSA<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                                 <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>META-INF/*/RSA<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                             <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                         <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">                     <span class="tag">&lt;/<span class="name">filters</span>&gt;</span></span><br><span class="line">                 <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>开发java类继承UDF，并重载evaluate 方法;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WjQiXiGeUDF</span> <span class="keyword">extends</span> <span class="title">UDF</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Text <span class="title">evaluate</span><span class="params">(<span class="keyword">final</span> Text s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == s) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//返回大写字母</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Text(s.toString().toUpperCase());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>将我们的项目打包，并上传到hive的lib目录下;</p>
</li>
<li><p>添加我们的jar包;</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /hive-1.1.0-cdh5.14.0/lib</span><br><span class="line">$ mv original-hive_udf-1.0-SNAPSHOT.jar udf.jar</span><br></pre></td></tr></table></figure>

<p>Hive的客户端添加jar包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add jar /hive-1.1.0-cdh5.14.0/lib/udf.jar</span><br></pre></td></tr></table></figure></li>
<li><p>设置函数与我们的自定义函数关联;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create temporary function tolowercase as &#39;cn.wjqixige.udf.WjQiXiGeUDF&#39;</span><br></pre></td></tr></table></figure></li>
<li><p>使用自定义函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select tolowercase(&#39;abc&#39;);</span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/hive/" rel="tag"># hive</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/12/15/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5/" rel="prev" title="数据仓库的基本概念">
                  <i class="fa fa-chevron-left"></i> 数据仓库的基本概念
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2019/12/15/hive%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9/" rel="next" title="hive的数据压缩">
                  hive的数据压缩 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





<script src="/js/comments.js"></script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">浙ICP备18041583号-1 </a>
      <img src="/images/beian.png">
  </div>

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.wj</span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
